<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fix Co-Host - One Click</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.box{background:#fff;border-radius:20px;padding:50px;max-width:700px;box-shadow:0 20px 60px rgba(0,0,0,0.3);text-align:center}
h1{color:#667eea;font-size:42px;margin-bottom:20px}
.code{background:#000;color:#0f0;padding:20px;border-radius:10px;font-family:monospace;font-size:12px;text-align:left;max-height:300px;overflow:auto;margin:20px 0}
.btn{background:#667eea;color:#fff;border:none;padding:20px 50px;font-size:20px;border-radius:10px;cursor:pointer;font-weight:700;margin:10px;transition:all 0.3s}
.btn:hover{background:#5a67d8;transform:translateY(-2px)}
.status{font-size:18px;margin:20px 0;padding:15px;border-radius:8px}
.success{background:#d4edda;color:#155724}
.error{background:#f8d7da;color:#721c24}
</style>
</head>
<body>
<div class="box">
<h1>ðŸ”§ Fix Co-Host</h1>
<p style="margin:20px 0;font-size:18px;color:#666">Step 1: Copy SQL below<br>Step 2: Open link<br>Step 3: Paste & Run</p>
<div class="code" id="sql"></div>
<a href="https://supabase.com/dashboard/project/fkypxitgnfqbfplxokve/sql" target="_blank" class="btn">OPEN SUPABASE SQL EDITOR</a>
<button class="btn" onclick="copy()" style="background:#28a745">COPY SQL</button>
<div id="status"></div>
</div>
<script>
const SQL=`DO $$
BEGIN
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'users' AND column_name = 'is_cohost') THEN
    ALTER TABLE users ADD COLUMN is_cohost BOOLEAN DEFAULT false;
  END IF;
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'users' AND column_name = 'parent_user_id') THEN
    ALTER TABLE users ADD COLUMN parent_user_id uuid REFERENCES users(id) ON DELETE SET NULL;
  END IF;
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'users' AND column_name = 'cohost_prefix') THEN
    ALTER TABLE users ADD COLUMN cohost_prefix TEXT UNIQUE;
  END IF;
END $$;

CREATE TABLE IF NOT EXISTS cohost_requests (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected')),
  requested_at timestamptz DEFAULT now(),
  admin_response_at timestamptz,
  admin_response_by TEXT,
  UNIQUE(user_id, requested_at)
);

ALTER TABLE cohost_requests ENABLE ROW LEVEL SECURITY;
DROP POLICY IF EXISTS "Users can view their own requests" ON cohost_requests;
DROP POLICY IF EXISTS "Users can insert their own requests" ON cohost_requests;
DROP POLICY IF EXISTS "Only admins can update requests" ON cohost_requests;
CREATE POLICY "Users can view their own requests" ON cohost_requests FOR SELECT USING (true);
CREATE POLICY "Users can insert their own requests" ON cohost_requests FOR INSERT WITH CHECK (true);
CREATE POLICY "Only admins can update requests" ON cohost_requests FOR UPDATE USING (true);
CREATE INDEX IF NOT EXISTS idx_cohost_requests_user_id ON cohost_requests(user_id);
CREATE INDEX IF NOT EXISTS idx_cohost_requests_status ON cohost_requests(status);
CREATE INDEX IF NOT EXISTS idx_users_parent_user_id ON users(parent_user_id);
CREATE INDEX IF NOT EXISTS idx_users_cohost_prefix ON users(cohost_prefix);
CREATE INDEX IF NOT EXISTS idx_users_is_cohost ON users(is_cohost);`;

document.getElementById('sql').textContent=SQL;
window.copy=()=>{navigator.clipboard.writeText(SQL);document.getElementById('status').innerHTML='<div class="status success">âœ… Copied! Now paste in Supabase</div>'};
</script>
</body>
</html>
